<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Porady Mechanika</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
    let serwerDate = null;
    let timerInterval = null;

    // Pobieranie porady z pliku
    async function aktualizujPorade() {
        const res = await fetch('porady.txt');
        const text = await res.text();
        const porady = text.split('\n').filter(l => l.trim().length > 0);
        const porada = porady.length > 0 ? porady[porady.length - 1] : 'Brak porady!';
        document.getElementById('porada-ai').innerText = porada;
    }

    function aktualizujZegar() {
        if (!serwerDate) return;
        serwerDate.setSeconds(serwerDate.getSeconds() + 1);
        const godzina = serwerDate.getUTCHours().toString().padStart(2, '0');
        const minuta = serwerDate.getUTCMinutes().toString().padStart(2, '0');
        const sekunda = serwerDate.getUTCSeconds().toString().padStart(2, '0');
        document.getElementById('serwer-godzina').innerText = `Godzina serwera: ${godzina}:${minuta}:${sekunda} UTC`;

        // Generowanie porady o 10:00:00 i 14:00:00 UTC
        if ((godzina === "10" || godzina === "14") && minuta === "00" && sekunda === "00") {
            aktualizujPorade();
        }

        // Synchronizacja zegara z serwerem o 10:00:00 i 14:00:00 UTC
        if ((godzina === "10" || godzina === "14") && minuta === "00" && sekunda === "00") {
            pobierzCzasSerwera();
        }
    }

    async function pobierzCzasSerwera() {
        try {
            const res = await fetch('porady.txt', { method: 'HEAD' });
            const dateHeader = res.headers.get('Date');
            if (dateHeader) {
                serwerDate = new Date(dateHeader);
                aktualizujZegar(); // od razu wyświetl
                if (!timerInterval) {
                    timerInterval = setInterval(aktualizujZegar, 1000); // odświeżanie co sekundę
                }
            } else {
                document.getElementById('serwer-godzina').innerText = 'Nie można pobrać godziny serwera.';
            }
        } catch {
            document.getElementById('serwer-godzina').innerText = 'Błąd pobierania godziny serwera.';
        }
    }

    window.addEventListener('DOMContentLoaded', () => {
        pobierzCzasSerwera();
        aktualizujPorade();
    });
    </script>
    <style>
        body { font-family: Arial; background: #f8f8f8; }
        main { max-width: 700px; margin: 30px auto; background: #fff; padding: 22px; border-radius: 8px; }
        .ai-box { background: #e7f5ff; color: #34527a; padding: 16px; border-radius: 6px; margin-bottom: 20px; }
        #serwer-godzina {
            position: fixed;
            right: 18px;
            bottom: 18px;
            background: #e7f5ff;
            color: #34527a;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(52,82,122,0.09);
            z-index: 99;
        }
    </style>
</head>
<body>
    <header>
        <h1>Porady Mechanika dla Kierowców</h1>
    </header>
    <main>
        <div class="ai-box">
            <h2>Codzienna porada AI:</h2>
            <div id="porada-ai">Wczytywanie...</div>
        </div>
        <h2>Porady ogólne:</h2>
        <ul>
            <li>Sprawdzaj poziom oleju i płynów eksploatacyjnych.</li>
            <li>Dbaj o regularność wymian filtrów.</li>
            <li>Nie zwlekaj z wymianą rozrządu.</li>
        </ul>
    </main>
    <footer>
        &copy; 2025 Porady Mechanika | Twórca: tabulek
    </footer>
    <div id="serwer-godzina"></div>
</body>
</html>
